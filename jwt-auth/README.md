## jwt-auth

**Jwt (Json Web Token)**

* JWT는 RFC7519 인터넷 표준으로 지정이 되어있고, 토큰 기반의 인증 시스템에서 가장 널리 사용되는 인증 방식이다.

**구성요소**

* Header : Signature를 해싱하기 위한 알고리즘 정보들이 담겨있음
* Payload : 서버와 클라이언트가 주고받는, 시스템에서 실제로 사용될 정보에 대한 내용들을 담고 있다.
* Signature : 토큰이 유효성 검증을 위한 문자열, 이 토큰이 유효한 토큰인지 확인가능

**JWT 인증 과정**

<img width="500" alt="스크린샷 2024-11-09 오후 11 52 20" src="https://github.com/user-attachments/assets/16781edb-d83f-4ab4-9aa2-22baa8c21870">

1. 사용자가 로그인을 합니다.
2. 서버에서는 계정 정보를 읽어 사용자를 확인 후, 사용자의 고유 ID 값을 부여한 후 기타 정보와 함께 Payload 에 집어넣습니다.
3. JWT 토큰의 유효기간을 설정합니다.
4. 암호화할 Secret key 를 이용해 Access Token 을 발급합니다.
5. 사용자는 Access Token 을 받아 저장 후, 인증이 필요한 요청마다 토큰을 헤더에 실어 보냅니다.
6. 서버에서는 해당 토큰의 Verify Signature 를 Secret key 로 복호화한 후, 조작 여부, 유효기간을 확인합니다.
7. 검증이 완료되었을 경우, Payload 를 디코딩 하여 사용자의 ID 에 맞는 데이터를 가져옵니다.

**JWT 장점**

- 중앙의 인증서버, 데이터 스토어에 대한 의존성 없음, 시스템 수평 확장 유리
- Base64 URL Safe Encoding -> URL, Cookie, Header 모두 사용 가능

**JWT 단점**

- Payload의 정보가 많아지면 트래픽이 높아지고, 네트워크 사용량 증가, 데이터 설계 고려 필요
- 토큰이 클라이언트에 저장, 서버에서 클라이언트의 토큰을 조작할 수 없음

차이점

세션 / 쿠키 방식과 가장 큰 차이점

* 세션 / 쿠키는 세션 저장소에 유저 정보를 넣는 반면, JWT 는 토큰 안에 유저의 정보들이 넣어진다는 점 입니다.
* 클라이언트 입장에서는 HTTP 헤더에 세션 ID 나 토큰을 실어서 보내준다는 점에선 동일하다
* 서버 측에서는 인증을 위해 암호화를 한다(JWT) vs 별도의 저장소를 이용(Session / Cookie) 한다 의 차이가 발생합니다.

로그인을 구현하는 방법

세션, 쿠키(Session, Cookie) vs 토큰(Token)

**세션, 쿠키 방식**

* (클라이언트**는 쿠키를 이용하고, 서버에서는 쿠키를 받아 세션의 정보를 접근하는 방식으로 인증)**
* 쿠키(서버에서 발급된 세션을 열기 위한 키, 클라이언트), 세션(서버에서 가지고 있는 정보) 방식은 서버에서 세션아이디를 기록하고, 브라우저에서 쿠키를 저장하는 방법이다.
* Session/Cookie 방식 인증은 기본적으로 세션 저장소를 필요로 한다. 세션 저장소는 로그인시 사용자 정보를 저장하고, 열쇠로 사용할 수 있는 세션 ID를 만든다. 
* 그리고 HTTP 헤더에 실어 클라이언트에게 보낸다. 브라우저는 세션 id를 포함하는 쿠키를 저장하고 있다. 인증이 필요한 요청에 해당 쿠키를 끼워 서버에 request를 보낸다.

**인증 절차**

- 클라이언트가 로그인
- 서버에서 계정 정보를 읽어 사용자 확인 → 사용자의 고유 id값을 부여한 후 세션 저장소에 저장하고, 이와 밀접한 세션 id값 발행
- 클라이언트는 서버에서 해당 세션 id를 받아 쿠키에 저장한 후, 인증이 필요한 요청마다 쿠키를 헤더에 끼워 보낸다.
- 서버에서는 쿠키를 받아 세션 저장소에서 확인 한 후, 일치하는 정보를 가져온다.
- 인증이 완료되고 서버는 사용자에 맞는 데이터를 보낸다.

장점

- 쿠키가 담긴 HTTP 요청이 노출되더 쿠키 자체(세션 ID)는 유의미한 값을 가지고 있음. 중요한 정보는 서버 세션에 존재.
- 고유한 ID 값을 받는다.

단점

- 세션 하이재킹(두 시스템 간의 연결이 활성화된 상태, 로그인된 상태를 가로채는 공격)공격 가능, 서버에서 추가적인 저장공간 필요

**토큰 방식**

* 토큰 방식은 토큰을 발행하여 토큰의 유효성을 검증하는 방법이다.
* 헤비하지 않고, 아주 간편하고 쉽게 적용할 수 있어서 사이드 프로젝트를 진행할 때는 매우 유용한 방식이다.
* 몇가지 고려사항만 잘 대응하면, 대규모 프로젝트에도 충분히 이용 가능한 방식

클라이언트는 Access Token (JWT Token) 을 HTTP 헤더에 실어 서버에 전송합니다. 토큰은 **임의로 생성된 비밀번호**
같이 동작합니다. 제한된 수명을 가지고, 새로운 토큰은 한번 만료되면 새로 생성되어야합니다.(Refresh Token)